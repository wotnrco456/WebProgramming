<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observer 패턴 - C++ 코드</title>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/layout.css">
    <link rel="stylesheet" href="../../css/pattern-detail.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <div class="logo">
                <h1>GameDev PatternHub</h1>
            </div>
            <div class="nav-links">
                <a href="../../index.html">홈</a>
                <a href="../../patterns.html">패턴 목록</a>
                <a href="#">데모 게임</a>
                <a href="#">문서</a>
            </div>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </nav>
    </header>

    <main class="pattern-detail">
        <section class="pattern-header">
            <div class="container">
                <h1>Observer 패턴 - C++ 코드</h1>
                <div class="pattern-meta">
                    <span class="category">행동 패턴</span>
                    <span class="language">C++ 구현</span>
                </div>
            </div>
        </section>

        <section class="pattern-content">
            <div class="container">
                <div class="content-section">
                    <h2>Observer 패턴의 C++ 구현</h2>
                    <p>Observer 패턴의 C++ 구현 코드와 사용 예시입니다.</p>
                    
                    <div class="code-section">
                        <h3>4.1 기본 Observer와 Subject 구현</h3>
                        <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;functional&gt;
#include &lt;string&gt;
#include &lt;memory&gt;

namespace ObserverPattern {

    // 전방 선언
    class Subject;

    // Observer 인터페이스
    class Observer {
    public:
        virtual ~Observer() = default;
        virtual void Update(Subject* subject) = 0;
    };

    // Subject 클래스
    class Subject {
    private:
        std::vector&lt;Observer*&gt; observers;
        int state;

    public:
        Subject() : state(0) {}

        void SetState(int newState) {
            if (state != newState) {
                state = newState;
                Notify();
            }
        }

        int GetState() const {
            return state;
        }

        void Attach(Observer* observer) {
            auto it = std::find(observers.begin(), observers.end(), observer);
            if (it == observers.end()) {
                observers.push_back(observer);
            }
        }

        void Detach(Observer* observer) {
            auto it = std::find(observers.begin(), observers.end(), observer);
            if (it != observers.end()) {
                observers.erase(it);
            }
        }

        void Notify() {
            for (Observer* observer : observers) {
                observer->Update(this);
            }
        }
    };

    // 구체적인 Observer 구현
    class ConcreteObserver : public Observer {
    private:
        std::string name;
        int observerState;

    public:
        ConcreteObserver(const std::string&amp; name) : name(name), observerState(0) {}

        void Update(Subject* subject) override {
            observerState = subject->GetState();
            std::cout &lt;&lt; name &lt;&lt; " 관찰자: 새 상태를 받았습니다 - " &lt;&lt; observerState &lt;&lt; std::endl;
        }
    };

    // 이벤트 기반 관찰자 패턴 구현
    class EventSource {
    private:
        // 이벤트 생성자를 위한 리스너 클래스
        using Listener = std::function&lt;void(int)&gt;;
        std::vector&lt;Listener&gt; listeners;
        int state;

    public:
        EventSource() : state(0) {}

        void AddListener(const Listener&amp; listener) {
            listeners.push_back(listener);
        }

        void RemoveListener(const Listener&amp; listener) {
            // 실제로는 함수 객체를 비교하는 것이 쉽지 않음
            // 여기서는 간단한 방법으로 구현
            // 실제 사용시에는 관찰자 ID 등을 사용해야 함
            // listeners.erase(std::remove_if(...));  // 실제로는 여기에 더 복잡한 코드가 필요
        }

        void SetState(int newState) {
            if (state != newState) {
                state = newState;
                NotifyListeners();
            }
        }

        void NotifyListeners() {
            for (const auto&amp; listener : listeners) {
                listener(state);
            }
        }
    };
}</code></pre>

                        <h3>4.2 사용 예시</h3>
                        <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;memory&gt;
#include &lt;string&gt;

// 상위 파일에서 정의한 클래스를 사용한다고 가정

using namespace ObserverPattern;

// 예제: 마우스 이벤트 관찰자
// 실제 프로그램에서는 윈도우 이벤트 등에 연결하게 됨
class MouseEventObserver : public Observer {
private:
    std::string name;
    
public:
    MouseEventObserver(const std::string&amp; name) : name(name) {}
    
    void Update(Subject* subject) override {
        int mouseState = subject->GetState();
        std::cout &lt;&lt; name &lt;&lt; ": 마우스 상태 변화 감지 - ";
        
        // 예제로 마우스 버튼 클릭 상태를 해석
        switch (mouseState) {
            case 1:
                std::cout &lt;&lt; "왼쪽 버튼 클릭" &lt;&lt; std::endl;
                break;
            case 2:
                std::cout &lt;&lt; "오른쪽 버튼 클릭" &lt;&lt; std::endl;
                break;
            case 3:
                std::cout &lt;&lt; "가운데 버튼 클릭" &lt;&lt; std::endl;
                break;
            default:
                std::cout &lt;&lt; "알 수 없는 상태" &lt;&lt; std::endl;
        }
    }
};

// 예제: 키보드 이벤트 관찰자
class KeyboardEventObserver : public Observer {
private:
    std::string name;
    
public:
    KeyboardEventObserver(const std::string&amp; name) : name(name) {}
    
    void Update(Subject* subject) override {
        int keyCode = subject->GetState();
        std::cout &lt;&lt; name &lt;&lt; ": 키보드 이벤트 감지 - 키 코드 " &lt;&lt; keyCode &lt;&lt; std::endl;
    }
};

// 이벤트 소스를 사용하는 예제
class EventSourceExample {
private:
    EventSource eventSource;
    
public:
    void Run() {
        std::cout &lt;&lt; "\n이벤트 소스 예제" &lt;&lt; std::endl;
        std::cout &lt;&lt; "---------------------------" &lt;&lt; std::endl;
        
        // 두 가지 다른 객체가 이벤트를 구독
        eventSource.AddListener([](int state) {
            std::cout &lt;&lt; "UI 업데이트: 새 상태 " &lt;&lt; state &lt;&lt; std::endl;
        });
        
        eventSource.AddListener([](int state) {
            std::cout &lt;&lt; "로깅: 새 상태 " &lt;&lt; state &lt;&lt; " 기록" &lt;&lt; std::endl;
        });
        
        // 상태 변경
        std::cout &lt;&lt; "\n상태를 42로 변경" &lt;&lt; std::endl;
        eventSource.SetState(42);
        
        std::cout &lt;&lt; "\n상태를 100으로 변경" &lt;&lt; std::endl;
        eventSource.SetState(100);
    }
};

// 예제: 날씨 시스템
class WeatherData : public Subject {
private:
    float temperature;
    float humidity;
    float pressure;
    
public:
    void SetMeasurements(float temperature, float humidity, float pressure) {
        this->temperature = temperature;
        this->humidity = humidity;
        this->pressure = pressure;
        
        // 날씨 데이터가 변경되었음을 통지
        Notify();
    }
    
    float GetTemperature() const { return temperature; }
    float GetHumidity() const { return humidity; }
    float GetPressure() const { return pressure; }
};

class CurrentConditionsDisplay : public Observer {
private:
    float temperature;
    float humidity;
    
public:
    void Update(Subject* subject) override {
        if (auto* weatherData = dynamic_cast&lt;WeatherData*&gt;(subject)) {
            temperature = weatherData->GetTemperature();
            humidity = weatherData->GetHumidity();
            Display();
        }
    }
    
    void Display() const {
        std::cout &lt;&lt; "현재 상태: " &lt;&lt; temperature &lt;&lt; "\u00b0C, " &lt;&lt; humidity &lt;&lt; "% 습도" &lt;&lt; std::endl;
    }
};

// 예제 프로그램
int main() {
    std::cout &lt;&lt; "Observer 패턴 예제 - C++" &lt;&lt; std::endl;
    std::cout &lt;&lt; "=========================" &lt;&lt; std::endl;
    
    // 1. 기본 Observer/Subject 패턴 예제
    Subject mouseEvents;
    
    // 관찰자 생성
    auto mouseObserver1 = std::make_unique&lt;MouseEventObserver&gt;("마우스 관찰자 1");
    auto mouseObserver2 = std::make_unique&lt;MouseEventObserver&gt;("마우스 관찰자 2");
    auto keyObserver = std::make_unique&lt;KeyboardEventObserver&gt;("키보드 관찰자");
    
    // 관찰자 등록
    mouseEvents.Attach(mouseObserver1.get());
    mouseEvents.Attach(mouseObserver2.get());
    mouseEvents.Attach(keyObserver.get());
    
    // 상태 변경 시뮬레이션
    std::cout &lt;&lt; "\n[마우스 왼쪽 버튼 클릭]" &lt;&lt; std::endl;
    mouseEvents.SetState(1);
    
    // 관찰자 제거
    std::cout &lt;&lt; "\n[마우스 관찰자 2 제거]" &lt;&lt; std::endl;
    mouseEvents.Detach(mouseObserver2.get());
    
    // 추가 상태 변경
    std::cout &lt;&lt; "\n[마우스 오른쪽 버튼 클릭]" &lt;&lt; std::endl;
    mouseEvents.SetState(2);
    
    // 2. 이벤트 소스 예제
    EventSourceExample eventExample;
    eventExample.Run();
    
    // 3. 날씨 시스템 예제
    std::cout &lt;&lt; "\n날씨 시스템 예제" &lt;&lt; std::endl;
    std::cout &lt;&lt; "---------------------------" &lt;&lt; std::endl;
    
    WeatherData weatherData;
    auto currentDisplay = std::make_unique&lt;CurrentConditionsDisplay&gt;();
    
    weatherData.Attach(currentDisplay.get());
    
    std::cout &lt;&lt; "\n[새로운 날씨 정보 업데이트]" &lt;&lt; std::endl;
    weatherData.SetMeasurements(27.5f, 65.0f, 1013.1f);
    
    std::cout &lt;&lt; "\n[더 더워진 날씨 정보 업데이트]" &lt;&lt; std::endl;
    weatherData.SetMeasurements(30.2f, 70.0f, 1010.3f);
    
    return 0;
}</code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="navigation-buttons">
                        <a href="../observer.html" class="back-button">패턴 설명으로 돌아가기</a>
                        <a href="observer_csharp.html" class="next-button">C# 코드 보기</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 GameDev PatternHub. All rights reserved.</p>
        </div>
    </footer>

    <script src="../../js/main.js"></script>
    <script>
        // 코드 하이라이팅 초기화
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    </script>
</body>
</html>